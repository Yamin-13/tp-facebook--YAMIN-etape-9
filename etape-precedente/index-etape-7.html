<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TP-Facebook-Etape-4</title>
    <link rel="stylesheet" href="./assset/css/style.css">
</head>

<body>

    <header>
        <!-- curseur dark mod----------------------------->
        <div class="header-content">
            <div id="fond">
                <div id="rond"></div>
            </div>
            <!-- logo stylisé de login ----------------------->
            <div id="profilLogin">
                <div class="teteLogin"></div>
                <div class="corps"></div>
                <p id="loginText">Login</p>
                <!-- <p id="logout">Logout</p> -->
            </div>
            <h1>Low Book</h1>
        </div>
        <!-- menu nav-------------------------------------->
        <nav id="menu">
            <a href="#">Nous rejoindre</a>
            <!-- <a href="#">Recherche</a> -->
            <a href="#">Le Blog</a>
            <!-- <a href="#">Notre Métier</a> -->
            <a href="#">Photos</a>
            <a href="#">Coups de Coeur</a>
            <a href="#">Evènements</a>
        </nav>
        <!-- menu burger------------------------------------->
        <!-- <div id="cmdMenu">&#9776;</div> -->
    </header>
    <!-- formulaire de soumission de post-------------- -->
    <article id="formulaireDePost">
        <form action="" id="postForm">
            <fieldset>
                <legend>POST</legend>
                <label for=""><input id="name" type="text" name="name" value="" placeholder="Votre pseudo"></label><br>
                <label for=""><input id="emotion" type="text" name="emotion" value=""
                        placeholder="Quoi de neuf ?"></label>
                <input type="file" id="fileInput" name="fileInput" class="upload">
                <button class="submit" type="submit">Valider</button>
            </fieldset>
        </form>
    </article>
    <!-- formulaire de login----------------------------- -->
    <div id="loginWindow">
        <h3>Authentification</h3>
        <div class="close" id="cancelButton">
            <div class="horizontal"></div>
            <div class="vertical"></div>
        </div>
        <form action="" id="loginForm" onsubmit="return login()">
            <div class="pseudoDiv">
                <label class="pseudo">Pseudo :<input id="pseudo" type="text" name="pseudo" value=""></label>
                <br>
                <label class="password" for="">Mot de passe :<input id="password" type="password" name="password"
                        value=""></label>
            </div>
            <button class="loginSubmit" type="submit">Connexion</button>
        </form>
        <div id="messageIdIncorect"></div>
    </div>

    <!-- conteneurs-------------------------------------------->

    <article id="postContainer">
        <!-- ça stock ici pour afficher les articles -->
    </article>
    <article id="htmlArticlesContainer">

    </article>
    <script>
        let articles = [];
        let janeDoe = document.getElementById('janeDoe');

        // pour soumettre un nouveau post
        document.querySelector('#postForm').addEventListener('submit', function (event) {
            event.preventDefault(); //ca ne renvoie pas vers une autre page

            // ca recupere les value
            let author = document.getElementById('name').value.trim(); //trim() enlève les espaces saisie
            let emotion = document.getElementById('emotion').value.trim();
            let url = document.getElementById('fileInput').value.trim();

            // conditions pour que le formulaire n'affiche rien si les champs sont tous vide
            if (author == '' && emotion == '' && url == '') {
                return; //ca retourne rien si c'est vide
            }
            // ca creer un post avec le pseudo de l'utilisateur connecté
            let post = {
                author: author,
                emotion: emotion,
                url: url

            };

            // push le post au tableau
            articles.push(post);

            // pour afficher les articles
            selectArticles();
        });

        function selectArticles() {
            // ça sélectionne le conteneur pour les articles
            let postContainer = document.getElementById('postContainer');

            for (let post of articles) {
                // 1ere) la chaine de caractere html est d'abord stocké ici
                let template = `
                    <article class="janeDoe">
                        <div class="close">
                            <div class="horizontal"></div>
                            <div class="vertical"></div>
                        </div>
                        <div class="profil">
                            <div class="tete"></div>
                            <div class="corps">
                                </div>
                                </div>
                                <h2>Posté par: ${pseudo.value}</h2> 
                                <p>${post.emotion}</p>
                        
                            <img class="flowerLike" src="./assset/img/variante-de-fleur.png">
                        
                    </article>
                `;

                // 2eme) ca convertis ici la chaîne de caractères en éléments HTML reels que le navigateur peux lire
                let articleElement = document.createElement('div'); //3eme) div qui sert de container pour l'html
                articleElement.innerHTML = template.trim(); //4eme) la propriété innerHTML sert à convertir en html reel 
                let article = articleElement.firstChild; //5eme) je recupere le premier élément enfant (article) de la div conteneur 

                // ======================== suppression d'article ==============================================
                // c'est une fonction pour supprimer les articles
                let closeDiv = article.querySelector('.close');
                if (closeDiv && showCloseButton(pseudo.value)) {
                    closeDiv.addEventListener('click', function () {
                        article.remove();

                    });
                }
                // ca récupère le premier article qui existe dans le conteneur des articles
                let firstArticle = postContainer.firstChild;

                // ca ajoute un nouvel article à chaque fois, postContainer est le parent et article est l'enfant qui existe déjkà
                // ca insère le nouvel article avant le premier article 
                postContainer.insertBefore(article, firstArticle);


            }
            // stop la boucle à la fin
            articles = [];

            // Réinitialise le formulaire
            document.getElementById('name').value = "";
            document.getElementById('emotion').value = "";

            // ====================== bouton like ==============================================================
            //  variable qui stocke l'état actuel de l'image si elle est true alors la'autre sera false
            let isFlowerImage = true;

            // sélectionne l'image qui sera modifier
            let imageLike = document.querySelector('.flowerLike');

            // écouteur d'événements au clic sur l'image
            imageLike.addEventListener("click", function () {
                //  ca inverse l'état de l'image avec l'opérateur de négation logique "!"
                isFlowerImage = !isFlowerImage;

                // Mise à jour de l'image en fonction de l'état actuel
                if (isFlowerImage) {
                    imageLike.src = "./assset/img/variante-de-fleur.png";
                } else {
                    imageLike.src = "./assset/img/petales-de-fleur.png";
                }
            });
        }
    </script>
    </div>
    <script src="./theme.js"></script>
    <script src="./scriptMenuBurger.js"></script>
    <script src="./login.js"></script>
    <script src="./objetHtml.js"></script>
</body>

</html>